
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../Ch6.%E5%B1%82%E6%AC%A1%E7%BB%93%E6%9E%84%E5%AD%98%E5%82%A8%E7%B3%BB%E7%BB%9F/">
      
      
        <link rel="next" href="../../%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/Ch0.Intro/">
      
      
        <link rel="alternate" type="application/rss+xml" title="RSS feed" href="../../../feed_rss_created.xml">
        <link rel="alternate" type="application/rss+xml" title="RSS feed of updated content" href="../../../feed_rss_updated.xml">
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.4">
    
    
      
        <title>Ch7.异常控制流 - Stoner的乱写笔记</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.8608ea7d.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#_1" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Stoner的乱写笔记" class="md-header__button md-logo" aria-label="Stoner的乱写笔记" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Stoner的乱写笔记
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Ch7.异常控制流
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="teal" data-md-color-accent="blue"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Stoner的乱写笔记" class="md-nav__button md-logo" aria-label="Stoner的乱写笔记" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Stoner的乱写笔记
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    AI
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            AI
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1" >
        
          
          <label class="md-nav__link" for="__nav_2_1" id="__nav_2_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    ML
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1">
            <span class="md-nav__icon md-icon"></span>
            ML
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../AI/ML/Ch2.%E6%A8%A1%E5%9E%8B%E8%AF%84%E4%BC%B0%E4%B8%8E%E9%80%89%E6%8B%A9/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Ch2.模型评估与选择
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" >
        
          
          <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    UmichEECS498 007
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            UmichEECS498 007
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../AI/UmichEECS498-007/Attention/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Attention
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../AI/UmichEECS498-007/CNN/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CNN
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../AI/UmichEECS498-007/Generative%20Models/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Generative Models
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../AI/UmichEECS498-007/Neural%20Network/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Neural Network
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../AI/UmichEECS498-007/Object%20Detection/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Object Detection
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../AI/UmichEECS498-007/Pytorch%20High-level%20API/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Pytorch High level API
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../AI/UmichEECS498-007/Pytorch%E5%9F%BA%E7%A1%80/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Pytorch基础
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../AI/UmichEECS498-007/RNN/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    RNN
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../AI/UmichEECS498-007/Training%20Neural%20Network/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Training Neural Network
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../AI/UmichEECS498-007/%E4%BC%98%E5%8C%96%E5%99%A8/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    优化器
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../AI/UmichEECS498-007/%E5%9B%BE%E5%83%8F%E5%88%86%E7%B1%BB/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    图像分类
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    CS
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            CS
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1" >
        
          
          <label class="md-nav__link" for="__nav_3_1" id="__nav_3_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    BDP
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1">
            <span class="md-nav__icon md-icon"></span>
            BDP
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../BDP/BDP/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    BDP
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" >
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    CPP
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            CPP
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../CPP/About%20Cpp/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    About Cpp
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3" >
        
          
          <label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    图形学
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3">
            <span class="md-nav__icon md-icon"></span>
            图形学
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../%E5%9B%BE%E5%BD%A2%E5%AD%A6/%E5%85%89%E6%A0%85%E5%8C%96Rasterization/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    光栅化Rasterization
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../%E5%9B%BE%E5%BD%A2%E5%AD%A6/%E5%85%89%E7%BA%BF%E8%BF%BD%E8%B8%AA/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    光线追踪
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../%E5%9B%BE%E5%BD%A2%E5%AD%A6/%E5%87%A0%E4%BD%95Geometry/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    几何Geometry
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../%E5%9B%BE%E5%BD%A2%E5%AD%A6/%E5%8A%A8%E7%94%BB/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    动画
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../%E5%9B%BE%E5%BD%A2%E5%AD%A6/%E7%9D%80%E8%89%B2Shading/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    着色Shading
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../%E5%9B%BE%E5%BD%A2%E5%AD%A6/%E7%BA%BF%E4%BB%A3%E3%80%81%E5%8F%98%E6%8D%A2Transformation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    线代、变换Transformation
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4" checked>
        
          
          <label class="md-nav__link" for="__nav_3_4" id="__nav_3_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    计算机系统基础
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_4">
            <span class="md-nav__icon md-icon"></span>
            计算机系统基础
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Ch1.Intro/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Ch1.Intro
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Ch2.%E6%95%B0%E6%8D%AE%E7%9A%84%E6%9C%BA%E5%99%A8%E7%BA%A7%E8%A1%A8%E7%A4%BA%E4%B8%8E%E5%A4%84%E7%90%86/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Ch2.数据的机器级表示与处理
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Ch3.%E7%A8%8B%E5%BA%8F%E7%9A%84%E8%BD%AC%E5%8C%96%E4%B8%8E%E6%9C%BA%E5%99%A8%E7%BA%A7%E8%A1%A8%E7%A4%BA/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Ch3.程序的转化与机器级表示
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Ch4.%E7%A8%8B%E5%BA%8F%E7%9A%84%E9%93%BE%E6%8E%A5/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Ch4.程序的链接
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Ch6.%E5%B1%82%E6%AC%A1%E7%BB%93%E6%9E%84%E5%AD%98%E5%82%A8%E7%B3%BB%E7%BB%9F/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Ch6.层次结构存储系统
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Ch7.异常控制流
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Ch7.异常控制流
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      进程
    </span>
  </a>
  
    <nav class="md-nav" aria-label="进程">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      上下文切换
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      可执行文件的加载
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      异常与中断
    </span>
  </a>
  
    <nav class="md-nav" aria-label="异常与中断">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      异常和中断的处理
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      异常
    </span>
  </a>
  
    <nav class="md-nav" aria-label="异常">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    <span class="md-ellipsis">
      异常举例——页故障
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#trap" class="md-nav__link">
    <span class="md-ellipsis">
      陷阱（Trap）异常
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    <span class="md-ellipsis">
      中断
    </span>
  </a>
  
    <nav class="md-nav" aria-label="中断">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    <span class="md-ellipsis">
      中断的分类
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    <span class="md-ellipsis">
      异常和中断的响应、处理
    </span>
  </a>
  
    <nav class="md-nav" aria-label="异常和中断的响应、处理">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    <span class="md-ellipsis">
      异常/中断响应过程
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ia-32linux" class="md-nav__link">
    <span class="md-ellipsis">
      IA-32/Linux下的异常/中断机制
    </span>
  </a>
  
    <nav class="md-nav" aria-label="IA-32/Linux下的异常/中断机制">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ia-32" class="md-nav__link">
    <span class="md-ellipsis">
      IA-32的中断
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ia-32_1" class="md-nav__link">
    <span class="md-ellipsis">
      IA-32的中断类型
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    <span class="md-ellipsis">
      实地址
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    <span class="md-ellipsis">
      保护模式下的中断描述符表
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ia-32_2" class="md-nav__link">
    <span class="md-ellipsis">
      IA-32中异常和中断响应过程
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ia-32_3" class="md-nav__link">
    <span class="md-ellipsis">
      IA-32中异常和中断返回过程
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#linux" class="md-nav__link">
    <span class="md-ellipsis">
      Linux中的异常和中断处理
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#linux_1" class="md-nav__link">
    <span class="md-ellipsis">
      Linux中中断描述符表的初始化
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#linux_2" class="md-nav__link">
    <span class="md-ellipsis">
      Linux中对异常的处理
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#linux_3" class="md-nav__link">
    <span class="md-ellipsis">
      Linux中对中断的处理
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ia-32linux_1" class="md-nav__link">
    <span class="md-ellipsis">
      IA-32/Linux的系统调用
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_5" >
        
          
          <label class="md-nav__link" for="__nav_3_5" id="__nav_3_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    计算机网络
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_5">
            <span class="md-nav__icon md-icon"></span>
            计算机网络
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/Ch0.Intro/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Ch0.Intro
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/Ch1.%E9%93%BE%E8%B7%AF%E5%B1%82/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    None
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Contest
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Contest
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Contest/Tip/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tip
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    数学
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            数学
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E6%95%B0%E5%AD%A6/%E6%A6%82%E7%8E%87%E8%AE%BA/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    概率论
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    编辑
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            编辑
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E7%BC%96%E8%BE%91/VSCode/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    VSCode
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_2" >
        
          
          <label class="md-nav__link" for="__nav_6_2" id="__nav_6_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Obsidian
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_2">
            <span class="md-nav__icon md-icon"></span>
            Obsidian
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E7%BC%96%E8%BE%91/Obsidian/Obsidian%E8%AF%AD%E6%B3%95/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Obsidian语法
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      进程
    </span>
  </a>
  
    <nav class="md-nav" aria-label="进程">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      上下文切换
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      可执行文件的加载
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      异常与中断
    </span>
  </a>
  
    <nav class="md-nav" aria-label="异常与中断">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      异常和中断的处理
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      异常
    </span>
  </a>
  
    <nav class="md-nav" aria-label="异常">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    <span class="md-ellipsis">
      异常举例——页故障
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#trap" class="md-nav__link">
    <span class="md-ellipsis">
      陷阱（Trap）异常
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    <span class="md-ellipsis">
      中断
    </span>
  </a>
  
    <nav class="md-nav" aria-label="中断">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    <span class="md-ellipsis">
      中断的分类
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    <span class="md-ellipsis">
      异常和中断的响应、处理
    </span>
  </a>
  
    <nav class="md-nav" aria-label="异常和中断的响应、处理">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    <span class="md-ellipsis">
      异常/中断响应过程
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ia-32linux" class="md-nav__link">
    <span class="md-ellipsis">
      IA-32/Linux下的异常/中断机制
    </span>
  </a>
  
    <nav class="md-nav" aria-label="IA-32/Linux下的异常/中断机制">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ia-32" class="md-nav__link">
    <span class="md-ellipsis">
      IA-32的中断
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ia-32_1" class="md-nav__link">
    <span class="md-ellipsis">
      IA-32的中断类型
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    <span class="md-ellipsis">
      实地址
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    <span class="md-ellipsis">
      保护模式下的中断描述符表
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ia-32_2" class="md-nav__link">
    <span class="md-ellipsis">
      IA-32中异常和中断响应过程
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ia-32_3" class="md-nav__link">
    <span class="md-ellipsis">
      IA-32中异常和中断返回过程
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#linux" class="md-nav__link">
    <span class="md-ellipsis">
      Linux中的异常和中断处理
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#linux_1" class="md-nav__link">
    <span class="md-ellipsis">
      Linux中中断描述符表的初始化
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#linux_2" class="md-nav__link">
    <span class="md-ellipsis">
      Linux中对异常的处理
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#linux_3" class="md-nav__link">
    <span class="md-ellipsis">
      Linux中对中断的处理
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ia-32linux_1" class="md-nav__link">
    <span class="md-ellipsis">
      IA-32/Linux的系统调用
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



  <h1>Ch7.异常控制流</h1>

<h2 id="_1">进程<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h2>
<ul>
<li>进程的引入为应用程序提供了以下两方面的抽象：<ul>
<li><strong>独立的逻辑控制流</strong>：每个进程拥有一个独立的逻辑控制流，使得程序员以为自己的程序在执行过程中独占使用处理器</li>
<li><strong>私有的虚拟地址空间</strong>：每个进程拥有一个私有的虚拟地址空间，使得程序员以为自己的程序在执行过程中独占使用存储器</li>
</ul>
</li>
</ul>
<h3 id="_2">上下文切换<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h3>
<p><img alt="" src="../../../img/Pasted%20image%2020240406234050.png" />
<img alt="" src="../../../img/Pasted%20image%2020240406234103.png" />
？？？？</p>
<h3 id="_3">可执行文件的加载<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h3>
<p>简单
<img alt="" src="../../../img/Pasted%20image%2020240406234451.png" /></p>
<h2 id="_4">异常与中断<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h2>
<p>程序执行被“中断”的事件在硬件层面有两类
- 内部“异常”：在CPU内部发生的意外事件或特殊事件。按发生原因分为<strong>硬故障中断</strong>和<strong>程序性中断</strong>两类
    - <strong>硬故障中断</strong>：如电源掉电、硬件线路故障等
    - <strong>程序性中断</strong>：执行某条指令时发生的“例外(Exception)”，如溢出、缺页、越界、越权、非法指令、除数为0、堆栈溢出、访问超时、断点设置、单步、系统调用等
- 外部“中断”：在CPU外部发生的特殊事件，通过“中断请求”信号向CPU请求处理。如实时钟、控制台、打印机缺纸、外设准备好、采样计时到、DMA传输结束等。</p>
<h3 id="_5">异常和中断的处理<a class="headerlink" href="#_5" title="Permanent link">&para;</a></h3>
<p>发生异常(exception)和中断(interrupt)事件后，系统将进入OS内核态对相应事件进行处理，即改变处理器状态（用户态→内核态）
<img alt="" src="../../../img/Pasted%20image%2020240408183346.png" /></p>
<h3 id="_6">异常<a class="headerlink" href="#_6" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>故障</strong>(fault) ：执行指令引起的异常事件，如溢出、缺页、堆栈溢出、访问超时等。<ul>
<li>“断点”为发生故障指令的地址</li>
<li>如缺页、TLB缺失</li>
</ul>
</li>
<li><strong>自陷</strong>(Trap) ：预先安排的事件，如单步跟踪、系统调用 (执行访管指令) 等。是一种<strong>自愿中断</strong><ul>
<li>”断点”为自陷指令下条指令地址</li>
</ul>
</li>
<li><strong>终止</strong>(Abort) ：硬故障事件，此时机器将“终止”，调出中断服务程序来重启操作系统。<ul>
<li>如溢出、除数为0、非法操作、内存保护错</li>
</ul>
</li>
</ul>
<h4 id="_7">异常举例——页故障<a class="headerlink" href="#_7" title="Permanent link">&para;</a></h4>
<ul>
<li>执行每条指令都要访存（取指令、取操作数、存结果）</li>
<li>在保护模式下，每次访存都要进行逻辑地址向物理地址转换</li>
<li>在地址转换过程中会发现是否发生了“页故障”</li>
<li>逻辑地址向物理地址的转换由硬件（MMU）实现，故“页故障”事件由硬件发现。所有异常和中断事件都由硬件检测发现！</li>
<li>以下情况均会发生"页故障“<ul>
<li>缺页：页表项有效位为0</li>
<li>地址越界：地址大于最大界限</li>
<li>访问越级或越权（保护违例）<ul>
<li><strong>越级</strong>：用户进程访问内核数据（CPL=3 / DPL=0）</li>
<li><strong>越权</strong>：读写权限不相符（如对只读段进行了写操作）</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="trap">陷阱（Trap）异常<a class="headerlink" href="#trap" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>陷阱</strong>也称<strong>自陷</strong>或<strong>陷入</strong>，执行陷阱指令（也称为自陷指令）时，CPU调出特定程序进行相应处理，处理结束后返回到陷阱指令的下一条指令执行。</li>
<li><strong>陷阱的作用之一是在用户和内核之间提供一个像过程一样的接口</strong>，这个接口称为<strong>系统调用</strong>，用户程序利用这个接口可方便地使用操作系统内核提供的一些服务。操作系统给每个服务编一个号，称为系统调用号。例如，Linux系统调用fork、read和execve的调用号分别是1、3和11。</li>
<li>陷阱指令异常称为编程异常（programmed exception），这些指令包括 INT n、int 3、into（溢出检查）、bound（地址越界检查）等</li>
</ul>
<h3 id="_8">中断<a class="headerlink" href="#_8" title="Permanent link">&para;</a></h3>
<ul>
<li>外设通过<strong>中断请求信号线</strong>向CPU提出“中断”请求，不由指令引起，故中断也称为异步异常</li>
<li>每执行完一条指令，CPU就查看中断请求引脚，若<strong>引脚的信号有效</strong>，则进行中断响应：将当前PC（断点）和当前机器状态保存到栈中，并“关中断”，然后，从数据总线读取中断类型号，根据中断类型号跳转到对应的中断服务程序执行。中断检测及响应过程由硬件完成</li>
</ul>
<h4 id="_9">中断的分类<a class="headerlink" href="#_9" title="Permanent link">&para;</a></h4>
<ul>
<li>Intel将中断分成可屏蔽中断（maskable interrupt）和不可屏蔽中断（nonmaskable interrupt，NMI）。<ul>
<li><strong>可屏蔽中断</strong>：通过 INTR 向CPU请求，可通过设置屏蔽字来屏蔽请求，若中断请求被屏蔽，则不会被送到CPU</li>
<li><strong>不可屏蔽中断</strong>：非常紧急的硬件故障，如：电源掉电，硬件线路故障等。通过 NMI 向CPU请求。一旦产生，就被立即送CPU，以便快速处理。这种情况下，中断服务程序会尽快保存系统重要信息，然后在屏幕上显示相应的消息或直接重启系统。</li>
<li><img alt="" src="../../../img/Pasted%20image%2020240408185057.png" /></li>
</ul>
</li>
</ul>
<h3 id="_10">异常和中断的响应、处理<a class="headerlink" href="#_10" title="Permanent link">&para;</a></h3>
<h4 id="_11">异常/中断响应过程<a class="headerlink" href="#_11" title="Permanent link">&para;</a></h4>
<p>检测到异常或中断时，CPU须进行以下基本处理：
1. <strong>关中断</strong>（“中断允许位” 清0）：使CPU处于“禁止中断”状态，以防止新中断破坏断点（PC）、程序状态（PSW）和现场（通用寄存器）。
2. <strong>保护断点和程序状态</strong>：将断点和程序状态保存到栈或特殊寄存器中
    <img alt="" src="../../../img/Pasted%20image%2020240408185323.png" />
3. <strong>识别异常事件</strong>：分为<strong>软件识别</strong>和<strong>硬件识别</strong>（向量中断）
    1. <strong>软件识别</strong>（MIPS采用）
        -  设置一个异常状态寄存器（MIPS中为Cause寄存器），用于记录异常原因。操作系统使用一个统一的异常处理程序，该程序按优先级顺序查询异常状态寄存器，识别出异常事件
    2. <strong>硬件识别（向量中断）</strong>（IA-32采用）
        - 用专门的硬件查询电路按优先级顺序识别异常，得到“中断类型号”，根据此号，到中断向量表中读取对应的中断服务程序的入口地址</p>
<h3 id="ia-32linux">IA-32/Linux下的异常/中断机制<a class="headerlink" href="#ia-32linux" title="Permanent link">&para;</a></h3>
<h4 id="ia-32">IA-32的中断<a class="headerlink" href="#ia-32" title="Permanent link">&para;</a></h4>
<ul>
<li>有256种不同类型的异常和中断</li>
<li>每个异常和中断都有唯一编号，称之为<strong>中断类型号</strong>（也称向量号）。如类型0为“除法错”，类型2为“NMI中断”，类型14为“缺页”</li>
<li>每个异常和中断有与其对应的<strong>异常处理程序</strong>或<strong>中断服务程序</strong>，其入口地址放在一个专门的<strong>中断向量表或中断描述符表</strong>中。</li>
<li>前32个类型（0~31）保留给CPU使用，剩余的由用户自行定义（这里的用户指机器硬件的用户，即操作系统）</li>
<li>通过执行INT n（指令第二字节给出中断类型号n，n=32~255）使CPU自动转到OS给出的中断服务程序执行</li>
<li><strong>实模式下，用中断向量表描述</strong></li>
<li><strong>保护模式下，用中断描述符表描述</strong></li>
</ul>
<h4 id="ia-32_1">IA-32的中断类型<a class="headerlink" href="#ia-32_1" title="Permanent link">&para;</a></h4>
<ul>
<li>用户自定义类型号为32~255，部分用于可屏蔽中断，部分用于软中断</li>
<li><strong>可屏蔽中断</strong>通过CPU的INTR 引脚向CPU发出中断请求</li>
<li><strong>软中断指令</strong> INT n 被设定为一种陷阱异常，例如，Linux通过int $0x80指令将128号设定为系统调用，而Windows通过int $0x2e指令将46号设定为系统调用。
<img alt="" src="../../../img/Pasted%20image%2020240408190531.png" /></li>
</ul>
<h4 id="_12">实地址<a class="headerlink" href="#_12" title="Permanent link">&para;</a></h4>
<p><img alt="" src="../../../img/Pasted%20image%2020240408190702.png" />
<img alt="" src="../../../img/Pasted%20image%2020240408191002.png" /></p>
<h4 id="_13">保护模式下的中断描述符表<a class="headerlink" href="#_13" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>段选择符</strong>用来指示异常处理程序或中断服务程序所在段的段描述符在<strong>GDT</strong>中的位置，其RPL=0；</li>
<li><strong>偏移地址</strong>则给出异常处理程序或中断服务程序第一条指令所在偏移量。</li>
<li><img alt="" src="../../../img/Pasted%20image%2020240408191653.png" /></li>
<li>P：Linux总把P置1。DPL：访问本段要求的最低特权级。主要用于防止恶意应用程序通过 INT n 指令模拟非法异常而进入内核态执行破坏性操作</li>
</ul>
<h4 id="ia-32_2">IA-32中异常和中断响应过程<a class="headerlink" href="#ia-32_2" title="Permanent link">&para;</a></h4>
<ol>
<li>确定中断类型号 i，从 IDTR 指向的 IDT 中取出第 i 个表项 IDTi。</li>
<li>根据 IDTi 中段选择符，从 GDTR 指向的 GDT 中取出相应段描述符，得到对应异常或中断处理程序所在段的 DPL、基地址等信息。Linux下中断门和陷阱门对应的即为内核代码段，所以DPL为0，基地址为0。</li>
<li>若<strong>CPL&lt;DPL</strong>或<strong>编程异常 IDTi 的 DPL&lt;CPL</strong>，则发生13号异常。Linux下，前者不会发生。后者用于防止恶意程序模拟 INT n 陷入内核进行破坏性操作。</li>
<li>若CPL≠DPL，则从用户态换至内核态，以使用内核栈。切换栈的步骤：<ol>
<li>读 TR 寄存器，以访问正在运行的用户进程的 TSS段；</li>
<li>. 将 TSS段中保存的内核栈的段选择符和栈指针分别装入寄存器 SS 和 ESP，然后在内核栈中保存原来用户栈的 SS 和 ESP。</li>
</ol>
</li>
<li>若是故障，则将发生故障的指令的逻辑地址写入 CS 和 EIP，以使处理后回到故障指令执行。其他情况下，CS 和 EIP 不变，使处理后回到下条指令执行。</li>
<li>在当前栈中保存 EFLAGS、CS 和 EIP 寄存器的内容（断点和程序状态）。</li>
<li>若异常产生了一个硬件出错码，则将其保存在内核栈</li>
<li>将IDTi中的段选择符装入CS，IDTi中的偏移地址装入EIP，它们是异常处理程序或中断服务程序第一条指令的逻辑地址（Linux中段基址=0）。</li>
</ol>
<h4 id="ia-32_3">IA-32中异常和中断返回过程<a class="headerlink" href="#ia-32_3" title="Permanent link">&para;</a></h4>
<p>中断或异常处理程序最后一条指令是IRET。CPU在执行IRET指令过程中完成以下工作：
1. 从栈中弹出硬件出错码（保存过的话）、EIP、CS和EFLAGS
2. 检查当前异常或中断处理程序的CPL是否等于CS中最低两位，若是则说明异常或中断响应前、后都处于同一个特权级，IRET指令完成操作；否则，再继续完成下一步工作。
3. 从内核栈中弹出SS和ESP，以恢复到异常或中断响应前的特权级进程所使用的栈。
4. 检查DS、ES、FS和GS段寄存器的内容，若其中有某个寄存器的段选择符指向一个段描述符且其DPL小于CPL，则将该段寄存器清0。这是为了防止恶意应用程序（CPL=3）利用内核以前使用过的段寄存器（DPL=0）来访问内核地址空间。
执行完IRET指令后，CPU回到原来发生异常或中断的进程继续执行</p>
<h4 id="linux">Linux中的异常和中断处理<a class="headerlink" href="#linux" title="Permanent link">&para;</a></h4>
<ul>
<li>Linux利用<strong>陷阱门来处理异常，利用中断门来处理中断</strong></li>
<li>异常和中断对应处理程序都属于内核代码段，所以，<strong>所有中断门和陷阱门的段选择符(0x60)都指向 GDT 中的“内核代码段”描述符。</strong></li>
<li>通过中断门进入到一个中断服务程序时，CPU 会清除 EFLAGS 寄存器中的 IF 标志，即关中断；通过陷阱门进入一个异常处理程序时，CPU 不会修改 IF 标志。也就是说，<strong>外部中断不支持嵌套处理，而内部异常则支持嵌套处理。</strong></li>
<li><strong>任务门描述符</strong>中不包含偏移地址，只包含 TSS 段选择符，这个段选择符指向 GDT 中的一个 TSS 段描述符，CPU 根据 TSS 段中的相关信息装载 EIP 和 ESP 等寄存器，从而执行相应的异常处理程序</li>
<li>Linux中，将类型号为8的双重故障（#DF）用任务门实现，而且是唯一通过任务门实现的异常。</li>
</ul>
<h4 id="linux_1">Linux中中断描述符表的初始化<a class="headerlink" href="#linux_1" title="Permanent link">&para;</a></h4>
<p>CPU负责对异常和中断的检测与响应，而<strong>操作系统则负责初始化 IDT 以及编制好异常处理程序或中断服务程序</strong>。Linux运用提供的三种门描述符格式，构造了以下5种类型的门描述符。
   1. <strong>中断门</strong>：DPL=0，TYPE=1110B。激活所有中断
   2. <strong>系统门</strong>：DPL=3，TYPE=1111B。激活4、5和128三个陷阱异常，分别对应指令into、bound和int $0x80三条指令。因DPL为3，CPL≤DPL，故在用户态下可使用这三条指令
   3. <strong>系统中断门</strong>：DPL=3，TYPE=1110B。激活3号中断（即调试断点），对应指令int 3。因DPL为3，CPL≤DPL，故用户态下可使用int 3指令
   4. <strong>陷阱门</strong>：DPL=0，TYPE=1111B。激活所有内部异常，并阻止用户程序使用INT n（n≠128或3）指令模拟非法异常来陷入内核态运行
   5. <strong>任务门</strong>：DPL=0，TYPE=0101B。激活8号中断（双重故障）。</p>
<h4 id="linux_2">Linux中对异常的处理<a class="headerlink" href="#linux_2" title="Permanent link">&para;</a></h4>
<p><img alt="" src="../../../img/Pasted%20image%2020240408193820.png" />
所有异常处理程序的结构是一致的，都可划分成以下三个部分：
1. 准备阶段：在内核栈保存通用寄存器内容（称为现场信息），这部分大多用汇编语言程序实现。
2. 处理阶段：采用C函数进行具体处理。函数名由do_前缀和处理程序名组成，如 do_overflow 为溢出处理函数。
    - 大部分函数的处理方式：保存硬件出错码（如果有的话）和异常类型号，然 后，向当前进程发送一个信号。
    - 当前进程接受到信号后，若有对应信号处理程序，则转信号处理程序执行；若没有，则调用内核abort例程执行，以终止当前进程。
    - 恢复阶段：恢复保存在内核栈中的 
3. 各个寄存器的内容，切换到用户态并 返回到当前进程的断点处继续执行</p>
<h4 id="linux_3">Linux中对中断的处理<a class="headerlink" href="#linux_3" title="Permanent link">&para;</a></h4>
<ul>
<li>对于大部分异常，Linux只是给引起异常的当前进程发送一个信号就结束异常处理，具体的异常处理转到信号处理程序进行。</li>
<li>对于中断，因为中断事件的发生与正在执行的当前进程很可能没有关系，所以将一个信号发给当前进程没有意义。</li>
<li>Linux中有三种类型中断。1. I/O中断：I/O外设的中断请求；2. 时钟中断：某时钟产生的中断请求，告知固定时间间隔到；3. 处理器中断：多处理器系统中其他处理器发出的中断请求。后两种超出了本教材范围</li>
<li>
<p>I/<strong>O中断</strong>：每个能发中断请求的外设控制器都有一条IRQ线，所有IRQ线连接到一个可编程中断控制器PIC （Programmable Interrupt Controller）中对应的IRQ引脚上，PIC中每个IRQ引脚（来自中断源）都有一个编号，如IRQ0、IRQ1、…、IRQi、…，可将与 IRQi 关联的中断类型号设定为32+i。</p>
</li>
<li>
<p>PIC需对所有外设来的 IRQ请求按优先级排队，若至少有一个IRQ线有请求且未被屏蔽，则 PIC向 CPU的 INTR引脚发中断请求。</p>
</li>
<li>CPU每执行完一条指令都会查询 INTR，若发现有中断请求，则进入中断响应过程，调出中断服务程序执行。</li>
</ul>
<p>所有中断服务程序的结构类似，都划分为以下三个阶段。
1. 准备阶段：在内核栈中保存各通用寄存器的内容（称为现场信息）以及所请求 IRQi 的值等，并给PIC回送应答信息，允许其发送新的中断请求信号。
2. 处理阶段：执行 IRQi 对应的中断服务例程 ISR （Interrupt Server Routine）。中断类型号为32+i
3. 恢复阶段：恢复保存在内核栈中的各个寄存器的内容，切换到用户态并返回到当前进程的逻辑控制流的断点处继续执行。</p>
<h4 id="ia-32linux_1">IA-32/Linux的系统调用<a class="headerlink" href="#ia-32linux_1" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>系统调用号</strong>是<strong>系统调用跳转表</strong>索引值，表中给出<strong>系统调用服务例程</strong>首址</li>
<li>通常，系统调用被封装成用户程序能直接调用的函数，如exit()、read()和open()，这些是标准C库中系统调用对应的封装函数 。</li>
<li><strong>Linux中系统调用所用参数通过寄存器传递</strong>，传递参数的寄存器顺序依次为：EAX（<strong>调用号</strong>）、EBX、ECX、EDX、ESI、EDI和EBP，除调用号以外，最多6个参数。</li>
<li><img alt="" src="../../../img/Pasted%20image%2020240408194719.png" /></li>
<li><img alt="" src="../../../img/Pasted%20image%2020240408195542.png" /></li>
<li>中断-&gt;取IDT表项-&gt;check表项DPL，要求DPL&gt;=CPL-&gt;切换内核态-&gt;装入IDT表项（选择符 与 偏移）
<img alt="" src="../../../img/Pasted%20image%2020240410111512.png" /></li>
</ul>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../..", "features": [], "search": "../../../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.f1b6f286.min.js"></script>
      
        <script src="../../../javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
        <script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
      
    
  </body>
</html>